<?xml version="1.0" encoding="windows-1252" ?>
<!--Ant buildfile generated by Oracle JDeveloper-->
<!--Generated Sep 18, 2008 12:51:30 PM-->
<project name="HumanTask" default="all" basedir=".">
  <property environment="env"/>

	<fail message="Please set the EIA_HOME as environment variable">
			<condition>
			   <not>
				   <isset property="env.EIA_HOME" />
			  </not>
			</condition>
	</fail>

	<fail message="Please set the JAVA_HOME as environment variable">
			<condition>
			   <not>
				   <isset property="env.JAVA_HOME" />
			  </not>
			</condition>
	</fail>

	<fail message="Please set the ANT_HOME as environment variable">
			<condition>
			   <not>
				   <isset property="env.ANT_HOME" />
			  </not>
			</condition>
	</fail>

	<tstamp>
	  <format property="deploy.timestamp"
			  pattern="yyyy-MM-DD-hhmmss.SSS"
			  locale="en,US"/>
	 </tstamp>

    <!--echo>Deploy Time Stamp ${deploy.timestamp}</echo-->


	<condition property="target.env" value="wisoad">
	  <not>
		    <isset property="target.env"/> 
      </not>
	</condition>

	<property name="web.dir" value="${webapp.dir}/public_html"/>
	<property name="webinf.dir" value="${web.dir}/WEB-INF"/>
    <property name="output.dir" value="${webinf.dir}/classes"/>

    <!--echo>Deploy Time Stamp ${deploy.timestamp}</echo-->

    <echo>EIA Home ${env.EIA_HOME} Target Environment ${target.env}</echo>

	<property file="${env.EIA_HOME}/config/EIAbuild-${target.env}.properties"/>


	
	<property name="eia.home" value="${env.EIA_HOME}"/>    

  <!-- master build.properties -->
  <!-- weblogic deployer task -->
  <taskdef name="wldeploy" classname="weblogic.ant.taskdefs.management.WLDeploy" 
     classpath="${wl_home}/server/lib/weblogic.jar:${wn.bea.home}/oracle_common/modules/oracle.jps_11.1.1/jps-common.jar:${wn.bea.home}/oracle_common/modules/oracle.jps_11.1.1/jps-api.jar:${wn.bea.home}/oracle_common/modules/oracle.jps_11.1.1/jps-internal.jar"/>
  <property name="humanTask.dc.dir" value="${oracle.home}/soa/modules/oracle.soa.workflow_11.1.1" />
  <property name="humanTask.lib.dir" value="${oracle.home}/soa/modules/oracle.soa.worklist_11.1.1"/>
  
  <target name="init" depends="clean">
    <tstamp/>
    <mkdir dir="${output.dir}"/>
  </target>

  <target name="all" description="Build the project"
          depends="compile,copy"/>

  <target name="clean" description="Clean the project">
    <echo>Cleanup of ${TaskApp}</echo>
    <delete includeemptydirs="true" quiet="true">
      <fileset dir="${output.dir}" includes="*/**"/>
      <fileset dir="${webinf.dir}/lib" includes="**/*"/>
      <fileset dir="${webinf.dir}/temp" includes="**/*"/>
    </delete>
    <delete file="${deployT.dir}/${TaskApp}.war"/>
    <delete file="${deployT.dir}/${TaskApp}.ear"/>
  </target>

  <target name="compile" description="Compile Java source files" depends="init">
    <javac destdir="${output.dir}"
           debug="${javac.debug}" 
           encoding="Cp1252" source="1.6"
           target="1.6">
      
      <src path="${app.dir}/src"/>
    </javac>
  </target>
  <target name="copy" description="Copy all files to output directory"
          depends="init" >
    <patternset id="copy.patterns">
      <include name="**/*.gif"/>
      <include name="**/*.jpg"/>
      <include name="**/*.jpeg"/>
      <include name="**/*.png"/>
      <include name="**/*.properties"/>
      <include name="**/*.xml"/>
      <include name="**/*-apf.xml"/>
      <include name="**/*.ejx"/>
      <include name="**/*.xcfg"/>
      <include name="**/*.cpx"/>
      <include name="**/*.dcx"/>
      <include name="**/*.sva"/>
      <include name="**/*.ini"/>
      <include name="**/*.tld"/>
      <include name="**/*.tag"/>
      <include name="**/*.xlf"/>
      <include name="**/*.wsdl"/>
      <include name="**/*.xsd"/>
    </patternset>
    <copy todir="${output.dir}">
      <fileset dir="${webapp.dir}/adfmsrc">
        <patternset refid="copy.patterns"/>
      </fileset>
      <fileset dir="${webapp.dir}/adfmsrc" includes="*.*"/>
      <fileset dir="..">
        <include name="services/**"/>
      </fileset>
    </copy>
  </target>

	<target name="adfconfig">

	 	<property name="adfconfigbasedir" value="${env.EIA_HOME}/config/.adf/META-INF"/>

	    <property name="tmp.adf.dir" value="${deployT.dir}/adf"/>
		<property name="tmp.adfmeta.dir" value="${tmp.adf.dir}/META-INF"/>

	 	<!--property name="adfconfigbasedir" value="${tmp.adfmeta.dir}"/-->
        <delete dir="${tmp.adfmeta.dir}" includeemptydirs="true" includes="*/**"/>
        <delete dir="${tmp.adf.dir}" includeemptydirs="true" />
		<mkdir dir="${tmp.adf.dir}" />
		<mkdir dir="${tmp.adfmeta.dir}" />
	
	 <echo>Creating custom adf config for customization of connections.xml - datasource: ${mds.jndi} </echo>
    <echo file="${tmp.adfmeta.dir}/adf-config.xml">&lt;?xml version="1.0" encoding="windows-1252" ?>
        &lt;adf-config xmlns="http://xmlns.oracle.com/adf/config">
          &lt;adf:adf-properties-child xmlns:adf="http://xmlns.oracle.com/adf/config/properties">
            &lt;adf-property name="adfAppUID" value="ATPOverrideHumanTaskForm"/>
          &lt;/adf:adf-properties-child>
          &lt;adf-mds-config xmlns="http://xmlns.oracle.com/adf/mds/config">
            &lt;mds-config xmlns="http://xmlns.oracle.com/mds/config">
              &lt;persistence-config>
                &lt;metadata-namespaces>
				               &lt;namespace path="/apps/EIAMetadata" metadata-store-usage="mstore-usage_2"/>
                &lt;/metadata-namespaces>
                &lt;metadata-store-usages>
                 &lt;metadata-store-usage id="mstore-usage_2">
                    &lt;metadata-store class-name="oracle.mds.persistence.stores.db.DBMetadataStore">
                     &lt;property name="partition-name" value="${mds.partition}"/>
                     &lt;property name="jndi-datasource" value="${mds.jndi}"/>
                     &lt;property name="jdbc-userid" value="${mds.userid}"/>
                     &lt;property name="jdbc-url" value="${mds.url}"/>
                    &lt;/metadata-store>
                  &lt;/metadata-store-usage>
                &lt;/metadata-store-usages>
              &lt;/persistence-config>
            &lt;/mds-config>
          &lt;/adf-mds-config>
        &lt;/adf-config> 
    </echo>
        
	 	<!--copy todir="${tmp.adfmeta.dir}">
		 <fileset dir="${adfconfigbasedir}">
		  <include name="adf-config.xml"/>
		 </fileset>
		</copy>
		<replace dir="${tmp.adfmeta.dir}" token="$mds-userid$" value="${mds.userid}">
			<include name="adf-config.xml"/>
		</replace> 
		<replace dir="${tmp.adfmeta.dir}" token="$mds-password$" value="${mds.password}">
			<include name="adf-config.xml"/>
		</replace> 
		<replace dir="${tmp.adfmeta.dir}" token="$mds-url$" value="${mds.url}">
			<include name="adf-config.xml"/>
		</replace> 
		<replace dir="${tmp.adfmeta.dir}" token="$mds-partition$" value="${mds.partition}">
			<include name="adf-config.xml"/>
		</replace-->
	 </target>

  <target name="create-ear" depends="compile, copy"
    description="Create the deployable ear archive">
    
	<mkdir dir="${deployT.dir}"/>

    <antcall target="adfconfig" inheritall="true"/>



    <copy todir="${webinf.dir}/lib">
        <!--fileset dir="${humanTask.lib.dir}" includes="adflibWorklistComponents.jar"/>
        <fileset dir="${humanTask.dc.dir}" includes="bpm-workflow-datacontrol.jar"/-->
        <!--fileset dir="${oracle.home}/jlib" includes="inspect4.jar"/-->
        
        <!--fileset dir="${wn.bea.home}/oracle_common/modules/oracle.javatools_11.1.1" includes="resourcebundle.jar"/>
        <fileset dir="${wn.bea.home}/oracle_common/modules/oracle.bali.share_11.1.1" includes="share.jar"/-->
        <fileset dir="${wn.bea.home}/oracle_common/modules/oracle.adf.view_11.1.1" includes="bundleresolver.jar"/>
        <fileset dir="${wn.bea.home}/oracle_common/modules" includes="org.apache.commons.beanutils_1.6.jar"/>
        <fileset dir="${oracle.home}/integration/lib" includes="wsrp-container.jar"/>
        <fileset dir="${wn.bea.home}/oracle_common/modules" includes="org.apache.commons.logging_1.0.4.jar"/>
        <fileset dir="${wn.bea.home}/modules" includes="com.bea.core.apache.commons.collections_3.2.0.jar"/>
    </copy>
        
    <war basedir="${web.dir}" destfile="${deployT.dir}/${TaskApp}.war"
        webxml="${webinf.dir}/web.xml">
        <include name="*/**"/>
    </war>

    <delete dir="${webinf.dir}/lib" includeemptydirs="true" includes="*/**"/>
    <delete dir="${webinf.dir}/lib"/>

   
        
    <property name="tmp.ear.lib" value="${deployT.dir}/lib"/>
    <mkdir dir="${tmp.ear.lib}"/>

    <copy file="${eia.home}/lib/adf-loc/adf-loc.jar" todir="${tmp.ear.lib}"/>

    <ear basedir="${deployT.dir}" appxml="${app.dir}/src/META-INF/application.xml"
        destfile="${deployT.dir}/${TaskApp}.ear">
        <include name="${TaskApp}.war"/>
        <include name="adf/**"/>
        <include name="lib/*"/>
        <fileset dir="${app.dir}/src">
            <include name="*/**"/>
            <exclude name="META-INF/application.xml"/>
        </fileset>
    </ear>

    <delete dir="${tmp.adfmeta.dir}" includeemptydirs="true" includes="*/**"/>
    <delete dir="${tmp.adf.dir}" includeemptydirs="true" />
    
    <delete dir="${tmp.ear.lib}" includeemptydirs="true" includes="*/**"/>
    <delete dir="${tmp.ear.lib}"/>
  </target>
  

  

</project>
