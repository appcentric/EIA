<?xml version="1.0" encoding="iso-8859-1"?>
<project name="resetEBSDatasources" default="run">

 <property environment="env"/>

    <fail message="Please set the EIA_HOME as environment variable">
        <condition>
            <not>
                <isset property="env.EIA_HOME" />
            </not>
        </condition>
 </fail>
    
 <fail message="Please set the JAVA_HOME as environment variable">
        <condition>
            <not>
                <isset property="env.JAVA_HOME" />
            </not>
        </condition>
 </fail>
    
 <fail message="Please set the ANT_HOME as environment variable">
        <condition>
            <not>
                <isset property="env.ANT_HOME" />
            </not>
        </condition>
 </fail>


    <tstamp>
        <format property="deploy.timestamp"
        pattern="yyyy-MM-DD-hhmmss.SSS"
        locale="en,US"/>
    </tstamp>
   

    
    <echo>EIA Home ${env.EIA_HOME} target ${target.env}</echo>
       
    
 <!--property file="${env.EIA_HOME}/config/EIAbuild.properties"/-->
 <property name="java.home" value="${env.JAVA_HOME}"/>
 <property name="eia.home" value="${env.EIA_HOME}"/>  
 
 <property file="${env.EIA_HOME}/config/EIAbuild-${target.env}.properties"/>
 <property name="ant-contib.jar" location="..."/>
 
  <exec executable="cmd">
    <arg line="/c ${wl_home}/server/bin/setWLSEnv.cmd"/>
  </exec>

 <!--taskdef classpathref="wl.classpath" name="wlst" classname="weblogic.ant.taskdefs.management.WLSTTask"/-->
  
  <target name="resetJDBC">
   <property name="admin.User" value="${server.user}"/>
   <property name="admin.Password" value="${server.password}"/>
   <property name="admin.Url" value="${admin.server.host}"/>
   <property name="admin.Port" value="${admin.server.port}"/>
   <property name="datasources" value="ebsapps,ebsapps_nonxa,ebsdb"/>
   <property name="servertargets" value="${server_targets}"/>

    <wlResetDatasource adminUser="${admin.User}" 
            adminPassword="${admin.Password}" 
            adminUrl="${admin.Url}" 
            adminPort="${admin.Port}" 
            datasourceNames="${datasources}"
            servertargets="${servertargets}"/>

   <!--wlst failonerror="true" classpathref="wl.classpath" debug="true" arguments="${admin.User} ${admin.Password} ${admin.Url} ${admin.Port} ${datasources} ${servertargets}">
      <script>
adminUser=sys.argv[0]
adminPassword=sys.argv[1]
adminUrl="t3://"+sys.argv[2]+":"+sys.argv[3]
datasourceNames=String(sys.argv[4]).split(",")
servertargets=String(sys.argv[5]).split(",")
connect(adminUser,adminPassword,adminUrl)
domainRuntime()
for datasourceName in datasourceNames:
  for servertarget in servertargets:
    cd('/')
    cd('ServerRuntimes/'+servertarget+'/JDBCServiceRuntime/'+servertarget+'/JDBCDataSourceRuntimeMBeans/'+datasourceName)
    objs = jarray.array([], java.lang.Object)
    strs = jarray.array([], java.lang.String)
    print 'Resetting '+datasourceName+' on target '+servertarget
    invoke('reset', objs, strs)
      </script>
    </wlst-->
    
  </target>
  
 

 <macrodef name="wlResetDatasource">
  <attribute name="adminUser"/>
  <attribute name="adminPassword"/>
  <attribute name="adminUrl"/>
  <attribute name="adminPort"/>
  <attribute name="datasourceNames"/>
  <attribute name="servertargets"/>
  <sequential>
    <wlst failonerror="true" debug="true" arguments="@{adminUser} @{adminPassword} @{adminUrl} @{adminPort} @{datasourceNames} @{servertargets}">
      <script>
adminUser=sys.argv[0]
adminPassword=sys.argv[1]
adminUrl="t3://"+sys.argv[2]+":"+sys.argv[3]
datasourceNames=String(sys.argv[4]).split(",")
servertargets=String(sys.argv[5]).split(",")
connect(adminUser,adminPassword,adminUrl)
domainRuntime()
for datasourceName in datasourceNames:
  for servertarget in servertargets:
    cd('/')
    cd('ServerRuntimes/'+servertarget+'/JDBCServiceRuntime/'+servertarget+'/JDBCDataSourceRuntimeMBeans/'+datasourceName)
    objs = jarray.array([], java.lang.Object)
    strs = jarray.array([], java.lang.String)
    print 'Resetting '+datasourceName+' on target '+servertarget
    invoke('reset', objs, strs)
      </script>
    </wlst>
  </sequential>
 </macrodef>

<target name="run" depends="resetJDBC">
      <echo/>
</target>

</project>